import{_ as ie}from"./Ch1fNMSO.js";import{_ as Z,p as H,g as de}from"./BNGwdjm8.js";import{ah as ee,ay as te,ai as d,aj as u,am as o,T as K,an as F,av as D,W as Q,ao as e,e as i,ak as n,al as c,aq as V,ad as j,ap as B,R as L,at as le,az as me,as as ae,ax as ne,Y as pe}from"./BhKvcAwN.js";import{u as W}from"./CX8KyqXw.js";import{u as se,g as oe,f as ve}from"./BWnmydqE.js";import{N as P}from"./Ck5Xhrkv.js";import{l as re}from"./CFDgI7c6.js";import{u as ye}from"./CvffFt6_.js";import"./BJ2ClxiI.js";import"./BUJnkN1Q.js";const fe={class:"itemX"},ce={class:"userchild"},_e={inline:"","m-r-4":""},ge={key:0},ke={id:"main"},be={key:0,inline:""},he={key:0},we={id:"main2"},$e={key:1,class:"userchild"},ue={__name:"Userreplylist",props:{parentmsg:{type:Object}},setup(v){let{message:m}=ee(["message"]);const C=W("user"),h=i(!1),U=i(!1),_=i(!1),x=i(""),y=i(""),g=i(),w=i(!1),k=i(""),p=i(""),$=async(s,t)=>{let r=await se(s);g.value.$img2Url(s,r)},S=s=>{_.value=!0,s.children==0&&(s.child=[])},N=()=>{_.value=!1,h.value=!1,k.value="",p.value=""},I=async(s,t,r)=>{_.value=!1;let l=C.value.wif,f=C.value.username,a=oe(),b=k.value,q=p.value,A={tags:["cn","cn-reader","starnote"],dapp:"starnote",format:"markdown"};if(b==""||q==""){m.error("标题和文本不能为空！",{duration:5e3});return}let E={parent_author:s,parent_permlink:t,title:b,author:f,permlink:a,body:q,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(A)};r.child.push(E);let J={wif:l,parentAuthor:s,parentPermlink:t,author:f,permlink:a,title:b,body:q,jsonMetadata:A};const{data:T,pending:Y,error:G}=await H("/starnoteapi/starpostdetail",J);G.value?m.error(`添加失败！
`+G.value,{duration:5e3}):m.success("添加成功",{duration:5e3}),k.value="",p.value=""},R=s=>{h.value=!0,U.value=!1,x.value=s.title,y.value=s.body},M=async s=>{h.value=!1,s.title=x.value,s.body=y.value;let t=C.value.wif,r=C.value.username,l=s.parent_author,f=s.parent_permlink,a=s.permlink,b=x.value,q=y.value,O=s.json_metadata,A={wif:t,parentAuthor:l,parentPermlink:f,author:r,permlink:a,title:b,body:q,jsonMetadata:O};const{data:E,pending:J,error:T}=await H("/starnoteapi/starpostdetail",A);T.value?m.error(`更新失败！
`+T.value,{duration:5e3}):m.success("更新成功",{duration:5e3}),x.value="",y.value=""},X=()=>{_.value=!1,h.value=!1,x.value="",y.value=""},z=()=>{w.value=!w.value,U.value=!0};return(s,t)=>{const r=te("mavon-editor"),l=Z,f=ue;return u(),d("div",fe,[o("div",ce,[o("a",{onClick:z},[o("div",null,"> "+D(v.parentmsg.title),1)]),K(o("div",null,[n(r,{class:"replymd",modelValue:v.parentmsg.body,"onUpdate:modelValue":t[0]||(t[0]=a=>v.parentmsg.body=a),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0},null,8,["modelValue"])],512),[[Q,e(w)]])]),K(o("div",null,[o("div",_e,[n(e(j),{tertiary:"",onClick:t[1]||(t[1]=a=>R(v.parentmsg))},{default:c(()=>[...t[9]||(t[9]=[V("编辑",-1)])]),_:1}),e(h)?(u(),d("div",ge,[n(l,null,{default:c(()=>[o("div",ke,[n(e(P),{value:e(x),"onUpdate:value":t[2]||(t[2]=a=>B(x)?x.value=a:null),type:"text",placeholder:"请输入章节名...","m-y-3":""},null,8,["value"]),n(r,{modelValue:e(y),"onUpdate:modelValue":t[3]||(t[3]=a=>B(y)?y.value=a:null),ref_key:"md",ref:g,defaultOpen:"edit",onImgAdd:$},null,8,["modelValue"])])]),_:1}),n(e(j),{quaternary:"","m-r-2":"",onClick:t[4]||(t[4]=a=>M(v.parentmsg))},{default:c(()=>[...t[10]||(t[10]=[V("更新",-1)])]),_:1}),n(e(j),{quaternary:"",onClick:X},{default:c(()=>[...t[11]||(t[11]=[V("取消",-1)])]),_:1})])):F("",!0)]),e(U)?(u(),d("div",be,[n(e(j),{tertiary:"",type:"primary",onClick:t[5]||(t[5]=a=>S(v.parentmsg))},{default:c(()=>[...t[12]||(t[12]=[V("+ 添加子章节",-1)])]),_:1})])):F("",!0)],512),[[Q,e(w)]]),e(_)?(u(),d("div",he,[n(l,null,{default:c(()=>[n(e(P),{value:e(k),"onUpdate:value":t[6]||(t[6]=a=>B(k)?k.value=a:null),type:"text",placeholder:"请输入子章节名...","m-y-3":""},null,8,["value"]),o("div",we,[n(r,{modelValue:e(p),"onUpdate:modelValue":t[7]||(t[7]=a=>B(p)?p.value=a:null),ref_key:"md",ref:g,defaultOpen:"edit",onImgAdd:$},null,8,["modelValue"])])]),_:1}),n(e(j),{quaternary:"","m-r-2":"",onClick:t[8]||(t[8]=a=>I(v.parentmsg.author,v.parentmsg.permlink,v.parentmsg))},{default:c(()=>[...t[13]||(t[13]=[V("提交",-1)])]),_:1}),n(e(j),{quaternary:"",onClick:N},{default:c(()=>[...t[14]||(t[14]=[V("取消",-1)])]),_:1})])):F("",!0),v.parentmsg.child?(u(),d("ul",$e,[(u(!0),d(L,null,le(v.parentmsg.child,(a,b)=>(u(),me(f,{parentmsg:a,key:b},null,8,["parentmsg"]))),128))])):F("",!0)])}}},Ce={key:0},xe=["src"],Oe={key:1,class:"reply"},Ve={__name:"Userreplies",props:{otherreply:{type:Object,default:{}}},async setup(v){let m,C;const h=v;let _=W("user").value.username;const y=ae().params.permlink,g=[];let w={author:_,permlink:y};const{data:k,pending:p}=([m,C]=ne(()=>H("/hiveapi/getallreplies",w)),m=await m,C(),m);return k.value&&k.value.result.forEach(S=>{S.author==_&&g.push(S)}),pe(h,()=>{g.push(h.otherreply)}),($,S)=>{const N=ue;return e(p)?(u(),d("div",Ce,[o("img",{src:e(re),alt:"miao loading"},null,8,xe)])):(u(),d("div",Oe,[(u(),d(L,null,le(g,I=>o("div",null,[n(N,{parentmsg:I},null,8,["parentmsg"])])),64))]))}}},je={"p-t-5":""},Ue={"px-10":""},Se={key:0},Ie={key:1},qe={key:2,"p-b-20":""},Fe={"text-size-2xl":"","text-center":"","m-t-2":""},Ne={"text-center":""},Ae={"text-5":""},Te={key:0},Be={flex:""},De={"m-y-4":""},Me={key:1},He={key:2,"text-center":""},Re=["src"],Qe={__name:"[permlink]",async setup(v){let m,C,{message:h}=ee(["message"]);const U=W("user"),_=U.value.username,y=ae().params.permlink;let g=i(!0);const w=i(!1),k=i(),p=i(""),$=i(),S=i(),N=i(),{data:I,pending:R,error:M}=([m,C]=ne(()=>de("/starnoteapi/note/@"+_+"/"+y)),m=await m,C(),m);I.value&&(g.value=!1,N.value=I.value.result.abstract),ye({title:"管理笔记"});const X=()=>{w.value=!0},z=async(r,l)=>{let f=await se(r);k.value.$img2Url(r,f)},s=async()=>{w.value=!1;let r=U.value.username,l=U.value.wif,f=p.value,a=$.value,b=oe(),O={tags:["cn","starnote"],dapp:"starnote",format:"markdown"},A={wif:l,parentAuthor:_,parentPermlink:y,author:r,permlink:b,title:f,body:a,jsonMetadata:O};const{data:E,pending:J,error:T}=await H("/starnoteapi/starpostdetail",A);T.value?h.error(`发布失败！
`+T.value,{duration:5e3}):h.success("发布成功",{duration:5e3});let Y={parent_author:_,parent_permlink:y,title:f,author:r,permlink:b,body:a,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(O)};S.value=Y,p.value="",$.value=""},t=()=>{w.value=!1,p.value="",$.value=""};return(r,l)=>{const f=ie,a=Ve,b=te("mavon-editor"),q=Z;return u(),d(L,null,[o("div",je,[n(e(j),{quaternary:"",onClick:l[0]||(l[0]=O=>r.$router.back())},{default:c(()=>[...l[3]||(l[3]=[o("span",{"m-l-6":"","m-r-4":"","text-5":""},"< ",-1)])]),_:1}),l[4]||(l[4]=V(" 管理页面 ",-1))]),o("div",Ue,[e(R)||e(g)?(u(),d("div",Se,[n(f)])):e(M)?(u(),d("div",Ie," 错误 "+D(e(M)),1)):(u(),d("div",qe,[o("div",Fe,D(e(I).result.title),1),o("p",Ne,D(("formatTime"in r?r.formatTime:e(ve))(e(I).result.created)),1),o("p",Ae,"简介： "+D(e(N)),1),e(g)?F("",!0):(u(),d("div",Te,[n(a,{otherreply:e(S)},null,8,["otherreply"])])),o("div",Be,[o("div",De,[n(e(j),{tertiary:"",type:"primary",onClick:X},{default:c(()=>[...l[5]||(l[5]=[V("+ 添加新章节",-1)])]),_:1})])]),e(w)?(u(),d("div",Me,[n(q,null,{default:c(()=>[o("div",null,[n(e(P),{value:e(p),"onUpdate:value":l[1]||(l[1]=O=>B(p)?p.value=O:null),type:"text",placeholder:"请输入章节名...","m-y-3":""},null,8,["value"]),n(b,{modelValue:e($),"onUpdate:modelValue":l[2]||(l[2]=O=>B($)?$.value=O:null),ref_key:"md",ref:k,defaultOpen:"edit",onImgAdd:z},null,8,["modelValue"])])]),_:1}),n(e(j),{quaternary:"","m-r-2":"",onClick:s},{default:c(()=>[...l[6]||(l[6]=[V("提交",-1)])]),_:1}),n(e(j),{quaternary:"",onClick:t},{default:c(()=>[...l[7]||(l[7]=[V("取消",-1)])]),_:1})])):F("",!0),e(g)?(u(),d("div",He,[o("img",{src:e(re),alt:"miao loading"},null,8,Re)])):F("",!0)]))])],64)}}};export{Qe as default};
