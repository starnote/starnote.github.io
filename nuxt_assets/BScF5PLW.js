import{_ as oe}from"./biAMTF3B.js";import{_ as W,p as R,g as se}from"./Dgk4jJtj.js";import{ah as Y,ay as G,ai as u,aj as i,am as s,T as X,an as D,av as M,W as L,ao as e,e as y,ak as n,al as v,aq as w,ad as $,ap as z,R as E,at as K,az as re,as as Q,ax as Z,Y as ie}from"./BJi9F7T9.js";import{u as J}from"./w5O4aCFK.js";import{u as ee,g as te,f as ue}from"./DFMnQmrK.js";import{l as ae}from"./YlgW88SJ.js";import{u as de}from"./D1wmksbD.js";import{N as me}from"./THSMEeuV.js";import"./BJ2ClxiI.js";import"./BerHFwYf.js";const pe={class:"itemX"},ve={class:"userchild"},ce={key:0},ye={key:0},fe={id:"main"},_e={key:1},ge={key:0},ke={id:"main2"},he={key:1,class:"userchild"},le={__name:"Userreplylist",props:{parentmsg:{type:Object}},setup(d){let{message:m}=Y(["message"]);const f=J("user"),k=y(!1),C=y(!1),o=y(),T=y(),h=y(!1),_=async(a,t)=>{let c=await ee(a);T.value.$img2Url(a,c)},V=a=>{C.value=!0,a.children==0&&(a.child=[])},I=async(a,t,c)=>{C.value=!1;let O=f.value.wif,U=f.value.username,r=te(),q="",p=o.value,g={tags:["cn","cn-reader","miao"],dapp:"miao",format:"markdown"};if(p==""){m.error("文本不能为空！",{duration:5e3});return}let N={parent_author:a,parent_permlink:t,title:q,author:U,permlink:r,body:p,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(g)};c.child.push(N);let F={wif:O,parentAuthor:a,parentPermlink:t,author:U,permlink:r,title:q,body:p,jsonMetadata:g};const{data:B,pending:S,error:H}=await R("/hiveapi/posttohive",F);H.value?m.error(`回复失败！
`+H.value,{duration:5e3}):m.success("回复成功",{duration:5e3}),o.value=""},j=a=>{k.value=!0,o.value=a.body},b=async a=>{k.value=!1,a.body=o.value;let t=f.value.wif,c=f.value.username,O=a.parent_author,U=a.parent_permlink,r=a.permlink,q=a.title,p=o.value,l=a.json_metadata,g={wif:t,parentAuthor:O,parentPermlink:U,author:c,permlink:r,title:q,body:p,jsonMetadata:l};const{data:N,pending:F,error:B}=await R("/hiveapi/posttohive",g);B.value?m.error(`更新失败！
`+B.value,{duration:5e3}):m.success("更新成功",{duration:5e3}),o.value=""},x=()=>{C.value=!1,k.value=!1,o.value=""},A=()=>{h.value=!h.value};return(a,t)=>{const c=G("mavon-editor"),O=W,U=le;return i(),u("div",pe,[s("div",ve,[s("a",{onClick:A},[s("div",null,"> "+M(d.parentmsg.title),1)]),X(s("div",null,[n(c,{class:"replymd",modelValue:d.parentmsg.body,"onUpdate:modelValue":t[0]||(t[0]=r=>d.parentmsg.body=r),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0},null,8,["modelValue"])],512),[[L,e(h)]])]),X(s("div",null,[d.parentmsg.author==e(f).username?(i(),u("div",ce,[n(e($),{quaternary:"",onClick:t[1]||(t[1]=r=>j(d.parentmsg))},{default:v(()=>[...t[7]||(t[7]=[w("编辑",-1)])]),_:1}),e(k)?(i(),u("div",ye,[n(O,null,{default:v(()=>[s("div",fe,[n(c,{modelValue:e(o),"onUpdate:modelValue":t[2]||(t[2]=r=>z(o)?o.value=r:null),ref_key:"md",ref:T,"m-y-3":"",onImgAdd:_},null,8,["modelValue"])])]),_:1}),n(e($),{quaternary:"","m-r-2":"",onClick:t[3]||(t[3]=r=>b(d.parentmsg))},{default:v(()=>[...t[8]||(t[8]=[w("更新",-1)])]),_:1}),n(e($),{quaternary:"",onClick:x},{default:v(()=>[...t[9]||(t[9]=[w("取消",-1)])]),_:1})])):D("",!0)])):(i(),u("div",_e,[n(e($),{quaternary:"",onClick:t[4]||(t[4]=r=>V(d.parentmsg))},{default:v(()=>[...t[10]||(t[10]=[w("回复",-1)])]),_:1})]))],512),[[L,e(h)]]),e(C)?(i(),u("div",ge,[n(O,null,{default:v(()=>[s("div",ke,[n(c,{modelValue:e(o),"onUpdate:modelValue":t[5]||(t[5]=r=>z(o)?o.value=r:null),ref_key:"md",ref:T,"m-y-3":"",onImgAdd:_},null,8,["modelValue"])])]),_:1}),n(e($),{quaternary:"","m-r-2":"",onClick:t[6]||(t[6]=r=>I(d.parentmsg.author,d.parentmsg.permlink,d.parentmsg))},{default:v(()=>[...t[11]||(t[11]=[w("提交",-1)])]),_:1}),n(e($),{quaternary:"",onClick:x},{default:v(()=>[...t[12]||(t[12]=[w("取消",-1)])]),_:1})])):D("",!0),d.parentmsg.child?(i(),u("ul",he,[(i(!0),u(E,null,K(d.parentmsg.child,(r,q)=>(i(),re(U,{parentmsg:r,key:q},null,8,["parentmsg"]))),128))])):D("",!0)])}}},be={key:0},we=["src"],$e={key:1,class:"reply"},Ce={__name:"Userreplies",props:{otherreply:{type:Object,default:{}}},async setup(d){let m,f;const k=d;let o=J("user").value.username;const h=Q().params.permlink,_=[];let V={author:o,permlink:h};const{data:I,pending:j}=([m,f]=Z(()=>R("/hiveapi/getallreplies",V)),m=await m,f(),m);return I.value&&I.value.result.forEach(x=>{x.author==o&&_.push(x)}),ie(k,()=>{_.push(k.otherreply)}),(b,x)=>{const A=le;return e(j)?(i(),u("div",be,[s("img",{src:e(ae),alt:"miao loading"},null,8,we)])):(i(),u("div",$e,[(i(),u(E,null,K(_,a=>s("div",null,[n(A,{parentmsg:a},null,8,["parentmsg"])])),64))]))}}},xe={"p-t-5":""},Ve={"px-10":""},je={key:0},Oe={key:1},Ue={key:2},qe={"text-size-2xl":"","text-center":"","m-t-2":""},Se={"text-center":""},Ie={"text-center":""},Ne={key:0},Fe={flex:""},Ae={"m-t-4":"","m-b-12":""},Be={key:1},De={key:2,"text-center":""},Te=["src"],Ke={__name:"[permlink]",async setup(d){let m,f,{message:k}=Y(["message"]);const C=J("user"),o=C.value.username,h=Q().params.permlink;let _=y(!0);const V=y(!1),I=y(),j=y(""),b=y(),x=y(),A=y(),{data:a,pending:t,error:c}=([m,f]=Z(()=>se("/starnoteapi/note/@"+o+"/"+h)),m=await m,f(),m);a.value&&(_.value=!1,A.value=a.value.result.abstract),de({title:"管理笔记"});const O=()=>{V.value=!0},U=async(p,l)=>{let g=await ee(p);I.value.$img2Url(p,g)},r=async()=>{V.value=!1;let p=C.value.username,l=C.value.wif,g=j.value,N=b.value,F=te(),S={tags:["cn","starnote"],dapp:"starnote",format:"markdown"},H={wif:l,parentAuthor:o,parentPermlink:h,author:p,permlink:F,title:g,body:N,jsonMetadata:S};const{data:Me,pending:He,error:P}=await R("/hiveapi/posttohive",H);P.value?k.error(`回复失败！
`+P.value,{duration:5e3}):k.success("回复成功",{duration:5e3});let ne={parent_author:o,parent_permlink:h,title:g,author:p,permlink:F,body:N,created:new Date().toISOString().split(".")[0],json_metadata:JSON.stringify(S)};x.value=ne,b.value=""},q=()=>{V.value=!1,b.value=""};return(p,l)=>{const g=oe,N=Ce,F=G("mavon-editor"),B=W;return i(),u(E,null,[s("div",xe,[n(e($),{quaternary:"",onClick:l[0]||(l[0]=S=>p.$router.back())},{default:v(()=>[...l[3]||(l[3]=[s("span",{"m-l-6":"","m-r-4":"","text-5":""},"< ",-1)])]),_:1}),l[4]||(l[4]=w(" 管理页面 ",-1))]),s("div",Ve,[e(t)||e(_)?(i(),u("div",je,[n(g)])):e(c)?(i(),u("div",Oe," 错误 "+M(e(c)),1)):(i(),u("div",Ue,[s("div",qe,M(e(a).result.title),1),s("p",Se,M(("formatTime"in p?p.formatTime:e(ue))(e(a).result.created)),1),s("p",Ie,"简介： "+M(e(A)),1),e(_)?D("",!0):(i(),u("div",Ne,[n(N,{otherreply:e(x)},null,8,["otherreply"])])),s("div",Fe,[s("div",Ae,[n(e($),{onClick:O},{default:v(()=>[...l[5]||(l[5]=[w("+ 添加新章节",-1)])]),_:1})])]),e(V)?(i(),u("div",Be,[n(B,null,{default:v(()=>[s("div",null,[n(e(me),{value:e(j),"onUpdate:value":l[1]||(l[1]=S=>z(j)?j.value=S:null),type:"text",placeholder:"请输入章节名...","m-t-5":""},null,8,["value"]),n(F,{modelValue:e(b),"onUpdate:modelValue":l[2]||(l[2]=S=>z(b)?b.value=S:null),ref_key:"md",ref:I,"h-40px":"","m-y-3":"",onImgAdd:U},null,8,["modelValue"])])]),_:1}),n(e($),{quaternary:"","m-r-2":"",onClick:r},{default:v(()=>[...l[6]||(l[6]=[w("提交",-1)])]),_:1}),n(e($),{quaternary:"",onClick:q},{default:v(()=>[...l[7]||(l[7]=[w("取消",-1)])]),_:1})])):D("",!0),e(_)?(i(),u("div",De,[s("img",{src:e(ae),alt:"miao loading"},null,8,Te)])):D("",!0)]))])],64)}}};export{Ke as default};
